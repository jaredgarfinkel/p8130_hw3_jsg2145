---
title: "p8130_hw3_jsg2145"
author: "Jared Garfinkel"
date: "10/25/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(viridis)
library(DescTools)
knitr::opts_chunk$set(
	echo = FALSE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

## Problem 2

```{r}
surv_df <- read_csv("./SurvCancer.csv") %>% 
  janitor::clean_names() %>% 
  mutate(organ =
           as.factor(organ),
         organ = 
           fct_reorder(organ, survival, .fun = median))
```

This is a dataset of the survival time of different types of cancer.

This dataset is `r nrow(surv_df)` rows by `r ncol(surv_df)` columns.

There are `r n_distinct(pull(surv_df,organ))` types of organs in the dataset.

```{r}
surv_df %>% 
  count(organ) %>% 
  rename(Organ = organ,
         Count = n) %>% 
  pivot_wider(
    names_from = Organ,
    values_from = Count
  ) %>% 
  knitr::kable(caption = "Count of Subjects.")
```

```{r}
surv_df %>% 
  group_by(organ) %>% 
  summarize(Median = median(survival),
            IQR = round(IQR(survival), digits = 1)
            ) %>% 
  rename(Organ = organ) %>% 
  knitr::kable()
```

```{r}
surv_df %>% 
  ggplot(aes(x = organ, y = survival)) +
  geom_boxplot() + 
  labs(x = "Organ",
       y = "Survival Time")
```

```{r}
surv_df %>% 
  lm() %>% 
  anova()
```

$H_0: \bar{X_1} = \bar{X_2} = ... = \bar{X_n}$

$H_1: \bar{X_i} \ne \bar{X_j}, i \ne j$

Reject $H_0$ when $F_{stat} > F_{crit} = F_{n-k-1,~1-\alpha/2 = F_{}}$

Fail to reject $H_0$ when $F_{stat} < F_{crit}$

There is sufficient evidence to conclude a significant difference between the 

the sample means (p = .0002295).

```{r}
pairwise.t.test(surv_df$survival, surv_df$organ, p.adj = "bonf", alternative = "two.sided")
```


```{r}
model1 <- surv_df %>% 
  lm() %>% 
  aov()

TukeyHSD(model1, conf.level = .01)
```

```{r}
DunnettTest(surv_df$survival ~ surv_df$organ, control = "Breast")
```

In Bonferroni, Tukey, and Dunnett adjustments a change is made to alpha 

to correct for the family-wise error rate. These results show that in all 

three methods, survival times of patients with breast cancer were significantly 

different at alpha = .01 from stomach cancer, bronchus cancer, and colon cancer.

```{r, fig.width = 10}
surv_df %>% 
  ggplot(aes(x = survival)) +
  geom_histogram(bins = 5) +
  facet_grid(.~organ, scales = "free_x") +
  labs(y = "Count",
       x = "Survival",
       caption = "Frequency of Survival.") +
  scale_y_continuous(breaks = c(2,4,6,8,10))
```

```{r}
uhat<-resid(model1)

shapiro.test(uhat)
```

An observation of the distribution of data in this dataset shows the data is 

not normally distributed. The Shapiro-Wilk normality test confirms this, returning

a very low p-value, indicating that the assumption that the data are normal can be 

rejected. One solution to this is to use a non-parametric test that depends on ranked

values rather than on a normality assumption. A Kruskal-Wallis test is acceptable here

because it extends the Wilcoxon rank-sum test to more than two groups.

```{r}
kruskal.test(survival ~ organ, data = surv_df)
```

This test confirms there are significant differences between the survival times 

of patients with different types of cancer at a p-value of 0.05. With further

pairwise testing it is possible to determine which pairs of groups are significantly different.

```{r}
pairwise.wilcox.test(surv_df$survival, surv_df$organ, p.adj = "bonf")
```

This table shows that without the normality assumption, none of the groups are 

significantly different. 

## Problem 3

```{r}
cats <- c("placebo", "iron", "zinc", "zinc_iron")
n <- c(56, 54, 54, 55)
u <- c(1.1, 1.4, .7, .8)
se <- c(0.2, 0.2, 0.1, 0.1)
epi_df <- tibble(
  cats, n, u, se
)
```

```{r}
epi_df %>% 
  rename(Treatment = cats,
         "Sample Size" = n,
         "Average # of Episodes in a Year" = u,
         "Standard Error" = se) %>% 
  knitr::kable()
```

```{r}
epi_df %>% 
  mutate(
    sd = se*sqrt(n)
  )
```

